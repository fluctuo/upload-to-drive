(()=>{var __webpack_modules__={272:module=>{module.exports=eval("require")("@actions/core")},430:module=>{module.exports=eval("require")("archiver")},241:module=>{module.exports=eval("require")("googleapis")},747:e=>{"use strict";e.exports=require("fs")}};var __webpack_module_cache__={};function __nccwpck_require__(e){var r=__webpack_module_cache__[e];if(r!==undefined){return r.exports}var t=__webpack_module_cache__[e]={exports:{}};var o=true;try{__webpack_modules__[e](t,t.exports,__nccwpck_require__);o=false}finally{if(o)delete __webpack_module_cache__[e]}return t.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var __webpack_exports__={};(()=>{const e=__nccwpck_require__(272);const{google:r}=__nccwpck_require__(241);const t=__nccwpck_require__(747);const o=__nccwpck_require__(430);const i=e.getInput("credentials",{required:true});const _=e.getInput("folder",{required:false});const a=e.getInput("fileId",{required:false});const c=e.getInput("target",{required:true});const n=e.getInput("name",{required:false});const s="link";const l=JSON.parse(Buffer.from(i,"base64").toString());const u=["https://www.googleapis.com/auth/drive"];const p=new r.auth.JWT(l.client_email,null,l.private_key,u);const d=r.drive({version:"v3",auth:p});const f=`https://drive.google.com/drive/folders/${_}`;let m=c.split("/").pop();async function main(){e.setOutput(s,f);if(t.lstatSync(c).isDirectory()){m=`${n||c}.zip`;e.info(`Folder detected in ${c}`);e.info(`Zipping ${c}...`);zipDirectory(c,m).then((()=>uploadToDrive())).catch((r=>{e.error("Zip failed");throw r}))}else uploadToDrive()}function zipDirectory(r,i){const _=o("zip",{zlib:{level:9}});const a=t.createWriteStream(i);return new Promise(((t,o)=>{_.directory(r,false).on("error",(e=>o(e))).pipe(a);a.on("close",(()=>{e.info(`Folder successfully zipped: ${_.pointer()} total bytes written`);return t()}));_.finalize()}))}function uploadToDrive(){e.info("Uploading file to Goole Drive...");const r={body:t.createReadStream(`${n||c}${t.lstatSync(c).isDirectory()?".zip":""}`)};let o;if(a){o=d.files.update({fileId:a,media:r})}else{o=d.files.create({requestBody:{name:m,parents:[_]},media:r})}o.then((()=>e.info("File uploaded successfully"))).catch((r=>{e.error("Upload failed");throw r}))}main().catch((r=>e.setFailed(r)))})();module.exports=__webpack_exports__})();